(node:25524) ExperimentalWarning: CommonJS module C:\Program Files\nodejs\node_modules\npm\node_modules\debug\src\node.js is loading ES Module C:\Program Files\nodejs\node_modules\npm\node_modules\supports-color\index.js using require().
Support for loading ES Module in require() is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    
    ≡ƒö╡ [TEST] [INFO] ≡ƒÜÇ Iniciando setup global de tests de integraci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [DB-HELPER] [INFO] Inicializando conexi├│n a base de datos original

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Conexi├│n a base de datos establecida

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "host": "localhost",
      "database": "gestion_proyectos"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [DB-HELPER] [INFO] Verificando que las tablas necesarias existen

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Todas las tablas necesarias est├ín presentes

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    Γ£à [TEST] [SUCCESS] Γ£à Setup global completado exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [TEST-CONFIG] [INFO] Configuraci├│n de tests cargada

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "database": "gestion_proyectos",
      "server": "localhost:3001",
      "testTimeout": 30000
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒÜÇ [USERS-TESTS] Iniciando: Configurando entorno de tests de usuarios

      at TestLogger.testStart (tests/utils/TestLogger.js:102:13)

  console.log
    
    ≡ƒö╡ [DB-HELPER] [INFO] Inicializando conexi├│n a base de datos original

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Conexi├│n a base de datos establecida

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "host": "localhost",
      "database": "gestion_proyectos"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [DB-HELPER] [INFO] Verificando que las tablas necesarias existen

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Todas las tablas necesarias est├ín presentes

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Entorno de tests configurado exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Obtener perfil propio

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "user@test.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4654,
      "email": "user@test.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4654, email: 'user@test.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4654,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: GET /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61553",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1NCwiZW1haWwiOiJ1c2VyQHRlc3QuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0MiwiZXhwIjoxNzU4MzA3MzQyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.X19faPXzPnZcqjiNqfvs-2pn1l4osTDKvqL-pTV8eMk",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1NCwiZW1haWwiOiJ1c2VyQHRlc3QuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0MiwiZXhwIjoxNzU4MzA3MzQyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.X19faPXzPnZcqjiNqfvs-2pn1l4osTDKvqL-pTV8eMk

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4654, email: 'user@test.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4654

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4654, email: 'user@test.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: { id: 4654, email: 'user@test.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4654, email: 'user@test.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4654,
      nombre: 'Usuario Test',
      email: 'user@test.com',
      'contrase├▒a': '$2b$10$tWiVKUi3Ixg4RLUMtgi/UuiM6TLreAkmmAXRaIp7Z3U7Slw2W7mx2',
      telefono: '0987654321',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:42:22.000Z,
      updated_at: 2025-09-19T17:42:22.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4654

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4654

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias ├║nicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4654

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4654, email: 'user@test.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:22 +0000] "GET /api/users/profile HTTP/1.1" 200 258 "-" "-" {"timestamp":"2025-09-19T17:42:22.239Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Perfil obtenido correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Acceso sin autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: GET /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61557",
      "accept-encoding": "gzip, deflate",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Ausente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: null

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Error: Token no encontrado

      at src/middleware/authMiddleware.js:36:19

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:22 +0000] "GET /api/users/profile HTTP/1.1" 401 55 "-" "-" {"timestamp":"2025-09-19T17:42:22.329Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Protecci├│n de endpoint funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Token inv├ílido

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: GET /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61559",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer token_invalido",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: token_invalido

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Error verificando token: jwt malformed

      at AuthService.verifyToken (src/services/authService.js:154:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Error en autenticaci├│n: Token inv├ílido

      at src/middleware/authMiddleware.js:68:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Stack trace: Error: Token inv├ílido
        at AuthService.verifyToken (D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\services\authService.js:156:15)
        at D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\middleware\authMiddleware.js:58:45
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      at src/middleware/authMiddleware.js:69:17

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:22 +0000] "GET /api/users/profile HTTP/1.1" 401 56 "-" "-" {"timestamp":"2025-09-19T17:42:22.410Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Validaci├│n de token funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Actualizaci├│n de perfil exitosa

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4655,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4655, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4655,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: PUT /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61561",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1NSwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0MiwiZXhwIjoxNzU4MzA3MzQyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.1h8UCaaa0AjY4bg33Q3ueIUG2v9IbrmDmAmhdQDZ50k",
      "content-type": "application/json",
      "content-length": "55",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1NSwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0MiwiZXhwIjoxNzU4MzA3MzQyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.1h8UCaaa0AjY4bg33Q3ueIUG2v9IbrmDmAmhdQDZ50k

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4655, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4655

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4655, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: { id: 4655, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4655, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4655,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contrase├▒a': '$2b$10$jwi6P.11QpMF0N/PEzMudu0syCd8gWTLoix2kBenkbyVjWTLJYhj6',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:42:22.000Z,
      updated_at: 2025-09-19T17:42:22.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4655

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4655

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias ├║nicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4655

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4655, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4655

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4655, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:22 +0000] "PUT /api/users/profile HTTP/1.1" 200 311 "-" "-" {"timestamp":"2025-09-19T17:42:22.596Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Perfil actualizado correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Validaci├│n de nombre requerido

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4656,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4656, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4656,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: PUT /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61564",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1NiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0MiwiZXhwIjoxNzU4MzA3MzQyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.gK5QcsJo6ndyhwMfLXEk2EAAedymfbfRQBPafBFTy3Q",
      "content-type": "application/json",
      "content-length": "37",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1NiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0MiwiZXhwIjoxNzU4MzA3MzQyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.gK5QcsJo6ndyhwMfLXEk2EAAedymfbfRQBPafBFTy3Q

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4656, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4656

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4656, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: { id: 4656, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4656, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4656,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contrase├▒a': '$2b$10$PZO3KHSe2irGMLQVJW7G0u4brlDKEZQjrbA.NWp/3umpFuVSbOSk2',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:42:22.000Z,
      updated_at: 2025-09-19T17:42:22.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4656

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4656

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias ├║nicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:22 +0000] "PUT /api/users/profile HTTP/1.1" 400 52 "-" "-" {"timestamp":"2025-09-19T17:42:22.751Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Validaci├│n de nombre funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Actualizaci├│n solo nombre

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4657,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4657, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4657,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: PUT /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61567",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1NywiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0MiwiZXhwIjoxNzU4MzA3MzQyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.jHTM_v8p7QKDf7QFLNOl0823PRcQHYTnPofTIJ6zZlg",
      "content-type": "application/json",
      "content-length": "30",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1NywiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0MiwiZXhwIjoxNzU4MzA3MzQyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.jHTM_v8p7QKDf7QFLNOl0823PRcQHYTnPofTIJ6zZlg

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4657, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4657

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4657, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: { id: 4657, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4657, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4657,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contrase├▒a': '$2b$10$vzxRawvJqmt2pldw2v2wCOw2ASbvlZrIk8uVQmou9wStIqpqQ5M5i',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:42:22.000Z,
      updated_at: 2025-09-19T17:42:22.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4657

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4657

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias ├║nicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4657

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4657, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4657

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4657, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:22 +0000] "PUT /api/users/profile HTTP/1.1" 200 302 "-" "-" {"timestamp":"2025-09-19T17:42:22.931Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Actualizaci├│n parcial funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Listar usuarios como admin

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4658,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4658, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1O...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4658,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando 3 usuarios de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test1@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4659,
      "email": "test1@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test2@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4660,
      "email": "test2@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test3@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4661,
      "email": "test3@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] 3 usuarios de prueba creados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: GET /

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61570",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1OCwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0MywiZXhwIjoxNzU4MzA3MzQzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.q43BRzEqVYHh3Hz4HVBJuvtm-07nDT73olE-gAzakfM",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY1OCwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0MywiZXhwIjoxNzU4MzA3MzQzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.q43BRzEqVYHh3Hz4HVBJuvtm-07nDT73olE-gAzakfM

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4658, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4658

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: {
      id: 4658,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: {
      id: 4658,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4658, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4658,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contrase├▒a': '$2b$10$gGhXdu7NZ3AscLO1SdkStORzN2VVQChb6hcqpRinjU6d6F5GnzUKC',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:42:23.000Z,
      updated_at: 2025-09-19T17:42:23.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4658

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    requirePermission - Iniciando verificaci├│n para: users:read

      at src/middleware/permissionMiddleware.js:32:17

  console.log
    requirePermission - Usuario autenticado: 4658 es_administrador: 1

      at src/middleware/permissionMiddleware.js:42:17

  console.log
    requirePermission - Usuario es admin, acceso permitido

      at src/middleware/permissionMiddleware.js:46:19

  console.log
    UserService.getAllUsers - Iniciando con: { page: 1, limit: 10, filters: {} }

      at UserService.getAllUsers (src/services/userService.js:26:15)

  console.log
    UserService.getAllUsers - Llamando userRepository.findAll con: { limit: 10, offset: 0, filters: {} }

      at UserService.getAllUsers (src/services/userService.js:32:15)

  console.log
    UserRepository.findAll - Iniciando con opciones: { limit: 10, offset: 0, filters: {} }

      at UserRepository.findAll (src/repositories/UserRepository.js:83:15)

  console.log
    UserRepository.findAll - Usuarios encontrados: 9

      at UserRepository.findAll (src/repositories/UserRepository.js:89:15)

  console.log
    UserService.getAllUsers - Usuarios obtenidos: 9

      at UserService.getAllUsers (src/services/userService.js:34:15)

  console.log
    UserService.getAllUsers - Llamando userRepository.count con: {}

      at UserService.getAllUsers (src/services/userService.js:36:15)

  console.log
    UserService.getAllUsers - Total count: 9

      at UserService.getAllUsers (src/services/userService.js:38:15)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:23 +0000] "GET /api/users HTTP/1.1" 200 - "-" "-" {"timestamp":"2025-09-19T17:42:23.302Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Lista de usuarios obtenida correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Acceso denegado para usuario regular

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4662,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4662, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY2M...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4662,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: GET /

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61572",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY2MiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0MywiZXhwIjoxNzU4MzA3MzQzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.RjaHYJjkIU083f-d_C3zM65JXMBf-KreEutf0OV8MuM",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY2MiwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0MywiZXhwIjoxNzU4MzA3MzQzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.RjaHYJjkIU083f-d_C3zM65JXMBf-KreEutf0OV8MuM

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4662, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4662

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4662, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: { id: 4662, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4662, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4662,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contrase├▒a': '$2b$10$WKpkeXeSl83hrhwtuEoNyOMwo95Ubwo3VCFmXyXzNhW9wAUjpR8fa',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:42:23.000Z,
      updated_at: 2025-09-19T17:42:23.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4662

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4662

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias ├║nicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

  console.log
    requirePermission - Iniciando verificaci├│n para: users:read

      at src/middleware/permissionMiddleware.js:32:17

  console.log
    requirePermission - Usuario autenticado: 4662 es_administrador: 0

      at src/middleware/permissionMiddleware.js:42:17

  console.log
    requirePermission - Obteniendo roles del usuario

      at src/middleware/permissionMiddleware.js:52:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4662

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias ├║nicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    requirePermission - Roles del usuario: []

      at src/middleware/permissionMiddleware.js:56:17

  console.log
    requirePermission - ┬┐Tiene permiso? false

      at src/middleware/permissionMiddleware.js:60:17

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:23 +0000] "GET /api/users HTTP/1.1" 403 130 "-" "-" {"timestamp":"2025-09-19T17:42:23.465Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Protecci├│n de endpoint administrativo funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Paginaci├│n de usuarios

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4663,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4663, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY2M...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4663,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando 5 usuarios de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test1@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4664,
      "email": "test1@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test2@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4665,
      "email": "test2@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test3@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4666,
      "email": "test3@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test4@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4667,
      "email": "test4@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test5@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4668,
      "email": "test5@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] 5 usuarios de prueba creados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: GET /

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61576",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY2MywiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0MywiZXhwIjoxNzU4MzA3MzQzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.rJC0PuODgVRdDjBa99RSAOnjGt4BWtJASaS-7AyLilI",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY2MywiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0MywiZXhwIjoxNzU4MzA3MzQzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.rJC0PuODgVRdDjBa99RSAOnjGt4BWtJASaS-7AyLilI

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4663, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4663

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: {
      id: 4663,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: {
      id: 4663,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4663, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4663,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contrase├▒a': '$2b$10$967mqD/71IGQrv.7D4Ha6ujm7ms9YTMEzcQMStHLlbrkASbOBSta.',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:42:23.000Z,
      updated_at: 2025-09-19T17:42:23.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4663

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    requirePermission - Iniciando verificaci├│n para: users:read

      at src/middleware/permissionMiddleware.js:32:17

  console.log
    requirePermission - Usuario autenticado: 4663 es_administrador: 1

      at src/middleware/permissionMiddleware.js:42:17

  console.log
    requirePermission - Usuario es admin, acceso permitido

      at src/middleware/permissionMiddleware.js:46:19

  console.log
    UserService.getAllUsers - Iniciando con: { page: 1, limit: 3, filters: {} }

      at UserService.getAllUsers (src/services/userService.js:26:15)

  console.log
    UserService.getAllUsers - Llamando userRepository.findAll con: { limit: 3, offset: 0, filters: {} }

      at UserService.getAllUsers (src/services/userService.js:32:15)

  console.log
    UserRepository.findAll - Iniciando con opciones: { limit: 3, offset: 0, filters: {} }

      at UserRepository.findAll (src/repositories/UserRepository.js:83:15)

  console.log
    UserRepository.findAll - Usuarios encontrados: 10

      at UserRepository.findAll (src/repositories/UserRepository.js:89:15)

  console.log
    UserService.getAllUsers - Usuarios obtenidos: 10

      at UserService.getAllUsers (src/services/userService.js:34:15)

  console.log
    UserService.getAllUsers - Llamando userRepository.count con: {}

      at UserService.getAllUsers (src/services/userService.js:36:15)

  console.log
    UserService.getAllUsers - Total count: 11

      at UserService.getAllUsers (src/services/userService.js:38:15)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:24 +0000] "GET /api/users?page=1&limit=3 HTTP/1.1" 200 - "-" "-" {"timestamp":"2025-09-19T17:42:24.028Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Paginaci├│n funcionando correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Obtener usuario espec├¡fico como admin

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4669,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4669, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY2O...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4669,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4670,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: GET /4670

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61579",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY2OSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0NCwiZXhwIjoxNzU4MzA3MzQ0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.xOUL1K2EiuqrI9iHqNuIoM7w29S_EP3ow7IfqlLyUTw",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY2OSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0NCwiZXhwIjoxNzU4MzA3MzQ0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.xOUL1K2EiuqrI9iHqNuIoM7w29S_EP3ow7IfqlLyUTw

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4669, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4669

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: {
      id: 4669,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: {
      id: 4669,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4669, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4669,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contrase├▒a': '$2b$10$rg4Bf/b.BBxEykIx/LtSUu/ZlzILF7J.SFOIUYkGg1q/KcrrYgXKm',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:42:24.000Z,
      updated_at: 2025-09-19T17:42:24.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4669

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4670

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4670, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:24 +0000] "GET /api/users/4670 HTTP/1.1" 200 261 "-" "-" {"timestamp":"2025-09-19T17:42:24.291Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Usuario espec├¡fico obtenido correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Usuario inexistente

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4671,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4671, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3M...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4671,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: GET /99999

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61581",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3MSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0NCwiZXhwIjoxNzU4MzA3MzQ0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.WFJo-08BomR8cy94WKb_dGTUlD72joXgQStCNZlewWk",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3MSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0NCwiZXhwIjoxNzU4MzA3MzQ0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.WFJo-08BomR8cy94WKb_dGTUlD72joXgQStCNZlewWk

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4671, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4671

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: {
      id: 4671,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: {
      id: 4671,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4671, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4671,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contrase├▒a': '$2b$10$Bpw.BgvRYBzIh40H8bI2reZdWYJy6uP/jEeqBLT76yyPJVXwCkby.',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:42:24.000Z,
      updated_at: 2025-09-19T17:42:24.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4671

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 99999

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 0

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] No se encontr├│ usuario con ID: 99999

      at UserRepository.findById (src/repositories/UserRepository.js:40:17)

  console.error
    Error en UserService.getUserById: Error: Usuario no encontrado
        at UserService.getUserById (D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\services\userService.js:64:15)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at UserController.getUserById (D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\controllers\userController.js:151:20)

    [0m [90m 67 |[39m       [36mreturn[39m [36mthis[39m[33m.[39msanitizeUser(user)[33m;[39m
     [90m 68 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 69 |[39m       console[33m.[39merror([32m'Error en UserService.getUserById:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 70 |[39m       [36mthrow[39m error[33m;[39m
     [90m 71 |[39m     }
     [90m 72 |[39m   }[0m

      at UserService.getUserById (src/services/userService.js:69:15)
      at UserController.getUserById (src/controllers/userController.js:151:20)

  console.error
    Error obteniendo usuario: Error: Usuario no encontrado
        at UserService.getUserById (D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\services\userService.js:64:15)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at UserController.getUserById (D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\controllers\userController.js:151:20)

    [0m [90m 164 |[39m
     [90m 165 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 166 |[39m       console[33m.[39merror([32m'Error obteniendo usuario:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 167 |[39m       res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 168 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 169 |[39m         message[33m:[39m [32m'Error interno del servidor'[39m[0m

      at UserController.getUserById (src/controllers/userController.js:166:15)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:24 +0000] "GET /api/users/99999 HTTP/1.1" 500 56 "-" "-" {"timestamp":"2025-09-19T17:42:24.461Z"}
  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Actualizar usuario como admin

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4672,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4672, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3M...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4672,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4673,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: PUT /4673

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61583",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3MiwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0NCwiZXhwIjoxNzU4MzA3MzQ0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.WJDa5lv_BUM-NmRA83zgMAVHgy2AxVCCCw-JxPui3Qs",
      "content-type": "application/json",
      "content-length": "65",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3MiwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0NCwiZXhwIjoxNzU4MzA3MzQ0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.WJDa5lv_BUM-NmRA83zgMAVHgy2AxVCCCw-JxPui3Qs

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4672, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4672

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: {
      id: 4672,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: {
      id: 4672,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4672, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4672,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contrase├▒a': '$2b$10$Xeg6HVCJD5CnpOnrOpdO7ecD9LZX941vXwdozy7YCVpEupGQWbbde',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:42:24.000Z,
      updated_at: 2025-09-19T17:42:24.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4672

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4673

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4673, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4673

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4673, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:24 +0000] "PUT /api/users/4673 HTTP/1.1" 200 322 "-" "-" {"timestamp":"2025-09-19T17:42:24.701Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Usuario actualizado por admin correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Usuario regular no puede actualizar otros

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4674,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4674, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4674,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "otro@test.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4675,
      "email": "otro@test.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: PUT /4675

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61585",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3NCwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0NCwiZXhwIjoxNzU4MzA3MzQ0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.AoKFc6N-nxNey6iQlKHkVPKNaQ3U9-LHI1jkGl6FAr0",
      "content-type": "application/json",
      "content-length": "38",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3NCwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzc0NCwiZXhwIjoxNzU4MzA3MzQ0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.AoKFc6N-nxNey6iQlKHkVPKNaQ3U9-LHI1jkGl6FAr0

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4674, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4674

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4674, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: { id: 4674, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4674, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4674,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contrase├▒a': '$2b$10$Ms950b0K1RSdlzwIznn/m.XjLKdaI0m0pKp05igQlT91QPyUOtPra',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:42:24.000Z,
      updated_at: 2025-09-19T17:42:24.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4674

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4674

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias ├║nicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

  console.log
    getUserRolesStatic - Iniciando para userId: 4674

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias ├║nicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:42:24 +0000] "PUT /api/users/4675 HTTP/1.1" 403 135 "-" "-" {"timestamp":"2025-09-19T17:42:24.987Z"}
  console.log
    
    Γ£à [USERS-TESTS] [SUCCESS] Protecci├│n de actualizaci├│n funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Eliminar usuario como admin

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4676,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4676, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4676,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4677,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: DELETE /4677

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61591",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3NiwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0NSwiZXhwIjoxNzU4MzA3MzQ1LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.Wvwb7rhU-cVZQMWo2anSPPwmrw0OsFditiS0sHJ0zhM",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3NiwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc0NSwiZXhwIjoxNzU4MzA3MzQ1LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.Wvwb7rhU-cVZQMWo2anSPPwmrw0OsFditiS0sHJ0zhM

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4676, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4676

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: {
      id: 4676,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: {
      id: 4676,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4676, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4676,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contrase├▒a': '$2b$10$aulXHX.E4iFnp.Bz9ZZazeh.svJBzfSRYOST.TM8S6/oMa5Eg8j/2',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:42:25.000Z,
      updated_at: 2025-09-19T17:42:25.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4676

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Eliminar usuario inexistente

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4678,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4678, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3O...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4678,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: DELETE /99999

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61607",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3OCwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc3NSwiZXhwIjoxNzU4MzA3Mzc1LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.89pc0Y5aSJT-N-HvzTLOhBRoA3VGzd8Q012p8xkKhUQ",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3OCwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMzc3NSwiZXhwIjoxNzU4MzA3Mzc1LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.89pc0Y5aSJT-N-HvzTLOhBRoA3VGzd8Q012p8xkKhUQ

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4678, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4678

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: {
      id: 4678,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: {
      id: 4678,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4678, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4678,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contrase├▒a': '$2b$10$e3AZT6pM/dJGul5..6x/uuMPLIHobMEqtqcyWM4YYK1/p474O203u',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:42:55.000Z,
      updated_at: 2025-09-19T17:42:55.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4678

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticaci├│n

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticaci├│n limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒùä∩╕Å  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    Γ£à [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ≡ƒö╡ [USERS-TESTS] [INFO] Test: Usuario regular no puede eliminar

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4679,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Generando token para usuario: { id: 4679, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    ≡ƒöÉ [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3O...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    ≡ƒöì [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       ≡ƒöº Debug: {
      "userId": 4679,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ≡ƒö╡ [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       ≡ƒôï Datos: {
      "email": "otro@test.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    Γ£à [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       ≡ƒôï Respuesta: {
      "id": 4680,
      "email": "otro@test.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Iniciando autenticaci├│n para: DELETE /4680

      at src/middleware/authMiddleware.js:27:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:61822",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3OSwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzgwNSwiZXhwIjoxNzU4MzA3NDA1LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.dx4XtO5x2VNl2CHQZai977fb1-meKozuHEwIvBwUVKU",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token extra├¡do: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDY3OSwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMzgwNSwiZXhwIjoxNzU4MzA3NDA1LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.dx4XtO5x2VNl2CHQZai977fb1-meKozuHEwIvBwUVKU

      at src/middleware/authMiddleware.js:33:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Token decodificado: { id: 4679, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    ≡ƒöì [USER-REPO] Buscando usuario por ID: 4679

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    ≡ƒöì [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    ≡ƒöì [USER-REPO] Usuario encontrado: { id: 4679, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario encontrado: { id: 4679, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    ≡ƒöÉ [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    ≡ƒöÉ [AUTH-MIDDLEWARE] Usuario verificado: { id: 4679, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4679,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contrase├▒a': '$2b$10$jUpZofziU4QA6jAhR9SMCeg0HDAz9QN5g1SPnc9zD2Ozok4uWStaq',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:43:25.000Z,
      updated_at: 2025-09-19T17:43:25.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4679

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4679

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias ├║nicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    ≡ƒöæ [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

