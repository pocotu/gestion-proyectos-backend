
ERROR STATUS: null
ERROR SIGNAL: SIGTERM

STDOUT:
  console.log
    
    🔵 [TEST] [INFO] 🚀 Iniciando setup global de tests de integración

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [DB-HELPER] [INFO] Inicializando conexión a base de datos original

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Conexión a base de datos establecida

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "host": "localhost",
      "database": "gestion_proyectos"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [DB-HELPER] [INFO] Verificando que las tablas necesarias existen

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Todas las tablas necesarias están presentes

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ✅ [TEST] [SUCCESS] ✅ Setup global completado exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [TEST-CONFIG] [INFO] Configuración de tests cargada

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "database": "gestion_proyectos",
      "server": "localhost:3001",
      "testTimeout": 30000
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🚀 [USERS-TESTS] Iniciando: Configurando entorno de tests de usuarios

      at TestLogger.testStart (tests/utils/TestLogger.js:102:13)

  console.log
    
    🔵 [DB-HELPER] [INFO] Inicializando conexión a base de datos original

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Conexión a base de datos establecida

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "host": "localhost",
      "database": "gestion_proyectos"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [DB-HELPER] [INFO] Verificando que las tablas necesarias existen

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Todas las tablas necesarias están presentes

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Entorno de tests configurado exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Obtener perfil propio

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "user@test.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4277,
      "email": "user@test.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4277, email: 'user@test.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI3N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4277,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: GET /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60243",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI3NywiZW1haWwiOiJ1c2VyQHRlc3QuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4MiwiZXhwIjoxNzU4MzA2NTgyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.FATi9SkbA_cRluH2tAQQVzHd3QCvOQffwYMcoxdaGIA",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI3NywiZW1haWwiOiJ1c2VyQHRlc3QuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4MiwiZXhwIjoxNzU4MzA2NTgyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.FATi9SkbA_cRluH2tAQQVzHd3QCvOQffwYMcoxdaGIA

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4277, email: 'user@test.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4277

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4277, email: 'user@test.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: { id: 4277, email: 'user@test.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4277, email: 'user@test.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4277,
      nombre: 'Usuario Test',
      email: 'user@test.com',
      'contraseña': '$2b$10$uNQZ7bBQoJu3e/rwT/02FuP1ynIBxLJMyxj13kGTXymJKhhkRzZS2',
      telefono: '0987654321',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:29:42.000Z,
      updated_at: 2025-09-19T17:29:42.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4277

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4277

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias únicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4277

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4277, email: 'user@test.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:42 +0000] "GET /api/users/profile HTTP/1.1" 200 258 "-" "-" {"timestamp":"2025-09-19T17:29:42.125Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Perfil obtenido correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Acceso sin autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: GET /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60247",
      "accept-encoding": "gzip, deflate",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Ausente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: null

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Error: Token no encontrado

      at src/middleware/authMiddleware.js:36:19

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:42 +0000] "GET /api/users/profile HTTP/1.1" 401 55 "-" "-" {"timestamp":"2025-09-19T17:29:42.173Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Protección de endpoint funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Token inválido

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: GET /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60249",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer token_invalido",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: token_invalido

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Error verificando token: jwt malformed

      at AuthService.verifyToken (src/services/authService.js:154:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Error en autenticación: Token inválido

      at src/middleware/authMiddleware.js:68:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Stack trace: Error: Token inválido
        at AuthService.verifyToken (D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\services\authService.js:156:15)
        at D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\middleware\authMiddleware.js:58:45
        at processTicksAndRejections (node:internal/process/task_queues:105:5)

      at src/middleware/authMiddleware.js:69:17

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:42 +0000] "GET /api/users/profile HTTP/1.1" 401 56 "-" "-" {"timestamp":"2025-09-19T17:29:42.208Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Validación de token funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Actualización de perfil exitosa

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4278,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4278, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI3O...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4278,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: PUT /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60251",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI3OCwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4MiwiZXhwIjoxNzU4MzA2NTgyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.Wuq8YHRUu9ZC2Qog0bWIkg-xe7tfSzMhOG5gzIYqAVk",
      "content-type": "application/json",
      "content-length": "55",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI3OCwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4MiwiZXhwIjoxNzU4MzA2NTgyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.Wuq8YHRUu9ZC2Qog0bWIkg-xe7tfSzMhOG5gzIYqAVk

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4278, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4278

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4278, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: { id: 4278, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4278, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4278,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contraseña': '$2b$10$gX/oLqUORZnQSDXVh5wX0uLY5cW3wWjtSEh.4Wz4igyY7gfw/dIA.',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:29:42.000Z,
      updated_at: 2025-09-19T17:29:42.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4278

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4278

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias únicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4278

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4278, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4278

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4278, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:42 +0000] "PUT /api/users/profile HTTP/1.1" 200 311 "-" "-" {"timestamp":"2025-09-19T17:29:42.345Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Perfil actualizado correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Validación de nombre requerido

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4279,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4279, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI3O...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4279,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: PUT /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60254",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI3OSwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4MiwiZXhwIjoxNzU4MzA2NTgyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.54Bec9dri8pdxbskJ6Cq9Ayq3VoB3Vs0Wq1fUaXoEQ4",
      "content-type": "application/json",
      "content-length": "37",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI3OSwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4MiwiZXhwIjoxNzU4MzA2NTgyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.54Bec9dri8pdxbskJ6Cq9Ayq3VoB3Vs0Wq1fUaXoEQ4

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4279, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4279

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4279, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: { id: 4279, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4279, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4279,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contraseña': '$2b$10$MfLlwZC32ya7iwa.bDjA9ekvm5BmDELPn1GOw4hNTixKOLR080efy',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:29:42.000Z,
      updated_at: 2025-09-19T17:29:42.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4279

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4279

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias únicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:42 +0000] "PUT /api/users/profile HTTP/1.1" 400 52 "-" "-" {"timestamp":"2025-09-19T17:29:42.462Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Validación de nombre funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Actualización solo nombre

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4280,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4280, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4M...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4280,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: PUT /profile

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60257",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4MCwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4MiwiZXhwIjoxNzU4MzA2NTgyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.NoV9VOXLShnaSlSjxdcukV2_DAgG6GKYSr-e-9Solu8",
      "content-type": "application/json",
      "content-length": "30",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4MCwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4MiwiZXhwIjoxNzU4MzA2NTgyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.NoV9VOXLShnaSlSjxdcukV2_DAgG6GKYSr-e-9Solu8

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4280, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4280

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4280, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: { id: 4280, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4280, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4280,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contraseña': '$2b$10$ZyXms1NRiVCGU6zXh.jlZunhSh30rVuya9tvSQWTDEos2M0INfH9O',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:29:42.000Z,
      updated_at: 2025-09-19T17:29:42.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4280

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4280

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias únicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4280

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4280, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4280

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4280, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:42 +0000] "PUT /api/users/profile HTTP/1.1" 200 302 "-" "-" {"timestamp":"2025-09-19T17:29:42.589Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Actualización parcial funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Listar usuarios como admin

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4281,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4281, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4M...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4281,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando 3 usuarios de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test1@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4282,
      "email": "test1@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test2@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4283,
      "email": "test2@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test3@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4284,
      "email": "test3@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] 3 usuarios de prueba creados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: GET /

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60260",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4MSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4MiwiZXhwIjoxNzU4MzA2NTgyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.XfSWKNjWQ2pNKdXv5z0k2TeOZh48mdfzZglZVlCTXZQ",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4MSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4MiwiZXhwIjoxNzU4MzA2NTgyLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.XfSWKNjWQ2pNKdXv5z0k2TeOZh48mdfzZglZVlCTXZQ

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4281, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4281

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: {
      id: 4281,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: {
      id: 4281,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4281, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4281,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contraseña': '$2b$10$o6marwmqgKlYpIyrsl40m.Cvex.pzvfclOXp.mCw7DnIZls0I6u2e',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:29:42.000Z,
      updated_at: 2025-09-19T17:29:42.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4281

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    requirePermission - Iniciando verificación para: users:read

      at src/middleware/permissionMiddleware.js:32:17

  console.log
    requirePermission - Usuario autenticado: 4281 es_administrador: 1

      at src/middleware/permissionMiddleware.js:42:17

  console.log
    requirePermission - Usuario es admin, acceso permitido

      at src/middleware/permissionMiddleware.js:46:19

  console.log
    UserService.getAllUsers - Iniciando con: { page: 1, limit: 10, filters: {} }

      at UserService.getAllUsers (src/services/userService.js:26:15)

  console.log
    UserService.getAllUsers - Llamando userRepository.findAll con: { limit: 10, offset: 0, filters: {} }

      at UserService.getAllUsers (src/services/userService.js:32:15)

  console.log
    UserRepository.findAll - Iniciando con opciones: { limit: 10, offset: 0, filters: {} }

      at UserRepository.findAll (src/repositories/UserRepository.js:83:15)

  console.log
    UserRepository.findAll - Usuarios encontrados: 9

      at UserRepository.findAll (src/repositories/UserRepository.js:89:15)

  console.log
    UserService.getAllUsers - Usuarios obtenidos: 9

      at UserService.getAllUsers (src/services/userService.js:34:15)

  console.log
    UserService.getAllUsers - Llamando userRepository.count con: {}

      at UserService.getAllUsers (src/services/userService.js:36:15)

  console.log
    UserService.getAllUsers - Total count: 9

      at UserService.getAllUsers (src/services/userService.js:38:15)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:43 +0000] "GET /api/users HTTP/1.1" 200 - "-" "-" {"timestamp":"2025-09-19T17:29:43.100Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Lista de usuarios obtenida correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Acceso denegado para usuario regular

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4285,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4285, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4285,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: GET /

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60262",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4NSwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4MywiZXhwIjoxNzU4MzA2NTgzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.KqDoadOof-yZ2J1VU9Z7CsJLXak8ukCP1lQlVOlERTs",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4NSwiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4MywiZXhwIjoxNzU4MzA2NTgzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.KqDoadOof-yZ2J1VU9Z7CsJLXak8ukCP1lQlVOlERTs

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4285, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4285

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4285, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: { id: 4285, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4285, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4285,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contraseña': '$2b$10$9o8ohEtHtNUe8a3GWeRmo.68Y/gHf3iRqe7vPE0jOP4dDJChdv9H.',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:29:43.000Z,
      updated_at: 2025-09-19T17:29:43.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4285

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4285

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias únicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

  console.log
    requirePermission - Iniciando verificación para: users:read

      at src/middleware/permissionMiddleware.js:32:17

  console.log
    requirePermission - Usuario autenticado: 4285 es_administrador: 0

      at src/middleware/permissionMiddleware.js:42:17

  console.log
    requirePermission - Obteniendo roles del usuario

      at src/middleware/permissionMiddleware.js:52:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4285

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias únicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    requirePermission - Roles del usuario: []

      at src/middleware/permissionMiddleware.js:56:17

  console.log
    requirePermission - ¿Tiene permiso? false

      at src/middleware/permissionMiddleware.js:60:17

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:43 +0000] "GET /api/users HTTP/1.1" 403 130 "-" "-" {"timestamp":"2025-09-19T17:29:43.245Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Protección de endpoint administrativo funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Paginación de usuarios

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4286,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4286, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4286,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando 5 usuarios de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test1@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4287,
      "email": "test1@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test2@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4288,
      "email": "test2@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test3@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4289,
      "email": "test3@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test4@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4290,
      "email": "test4@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test5@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4291,
      "email": "test5@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] 5 usuarios de prueba creados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: GET /

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60267",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4NiwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4MywiZXhwIjoxNzU4MzA2NTgzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.QCHYLx4wg4jovk987xci43NDCtntlMkZ3DYpFxe_wOM",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI4NiwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4MywiZXhwIjoxNzU4MzA2NTgzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.QCHYLx4wg4jovk987xci43NDCtntlMkZ3DYpFxe_wOM

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4286, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4286

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: {
      id: 4286,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: {
      id: 4286,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4286, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4286,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contraseña': '$2b$10$fbMMKWWIo9FNYe2xzN2gy.2Y3IikcWmrFg1ZmsxBOxvrTyanKz7H2',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:29:43.000Z,
      updated_at: 2025-09-19T17:29:43.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4286

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    requirePermission - Iniciando verificación para: users:read

      at src/middleware/permissionMiddleware.js:32:17

  console.log
    requirePermission - Usuario autenticado: 4286 es_administrador: 1

      at src/middleware/permissionMiddleware.js:42:17

  console.log
    requirePermission - Usuario es admin, acceso permitido

      at src/middleware/permissionMiddleware.js:46:19

  console.log
    UserService.getAllUsers - Iniciando con: { page: 1, limit: 3, filters: {} }

      at UserService.getAllUsers (src/services/userService.js:26:15)

  console.log
    UserService.getAllUsers - Llamando userRepository.findAll con: { limit: 3, offset: 0, filters: {} }

      at UserService.getAllUsers (src/services/userService.js:32:15)

  console.log
    UserRepository.findAll - Iniciando con opciones: { limit: 3, offset: 0, filters: {} }

      at UserRepository.findAll (src/repositories/UserRepository.js:83:15)

  console.log
    UserRepository.findAll - Usuarios encontrados: 10

      at UserRepository.findAll (src/repositories/UserRepository.js:89:15)

  console.log
    UserService.getAllUsers - Usuarios obtenidos: 10

      at UserService.getAllUsers (src/services/userService.js:34:15)

  console.log
    UserService.getAllUsers - Llamando userRepository.count con: {}

      at UserService.getAllUsers (src/services/userService.js:36:15)

  console.log
    UserService.getAllUsers - Total count: 11

      at UserService.getAllUsers (src/services/userService.js:38:15)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:43 +0000] "GET /api/users?page=1&limit=3 HTTP/1.1" 200 - "-" "-" {"timestamp":"2025-09-19T17:29:43.733Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Paginación funcionando correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Obtener usuario específico como admin

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4292,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4292, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5M...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4292,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4293,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: GET /4293

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60269",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5MiwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4MywiZXhwIjoxNzU4MzA2NTgzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.Rx_PdiIopgXUdP-jXm2OiCJupVxX9WH32jh6uVQ5EJE",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5MiwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4MywiZXhwIjoxNzU4MzA2NTgzLCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.Rx_PdiIopgXUdP-jXm2OiCJupVxX9WH32jh6uVQ5EJE

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4292, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4292

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: {
      id: 4292,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: {
      id: 4292,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4292, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4292,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contraseña': '$2b$10$TrLctdyvXJjLzA5DW6qP1eMvkHBQ7um2JWhTw0zpa2DbCaMHSJcYC',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:29:43.000Z,
      updated_at: 2025-09-19T17:29:43.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4292

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4293

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4293, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:43 +0000] "GET /api/users/4293 HTTP/1.1" 200 261 "-" "-" {"timestamp":"2025-09-19T17:29:43.928Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Usuario específico obtenido correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Usuario inexistente

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4294,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4294, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4294,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: GET /99999

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60271",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5NCwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4NCwiZXhwIjoxNzU4MzA2NTg0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.CsXjPRmLhoj_WC_5h0xtCZBVNIe3T9ym8WeIxNcnCpw",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5NCwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4NCwiZXhwIjoxNzU4MzA2NTg0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.CsXjPRmLhoj_WC_5h0xtCZBVNIe3T9ym8WeIxNcnCpw

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4294, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4294

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: {
      id: 4294,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: {
      id: 4294,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4294, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4294,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contraseña': '$2b$10$bvQkRNPU9WU251uKwljvDunhGElKCLw1dwpU8JTNSZiRsHqDaMEAO',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:29:44.000Z,
      updated_at: 2025-09-19T17:29:44.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4294

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 99999

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 0

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] No se encontró usuario con ID: 99999

      at UserRepository.findById (src/repositories/UserRepository.js:40:17)

  console.error
    Error en UserService.getUserById: Error: Usuario no encontrado
        at UserService.getUserById (D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\services\userService.js:64:15)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at UserController.getUserById (D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\controllers\userController.js:151:20)

    [0m [90m 67 |[39m       [36mreturn[39m [36mthis[39m[33m.[39msanitizeUser(user)[33m;[39m
     [90m 68 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 69 |[39m       console[33m.[39merror([32m'Error en UserService.getUserById:'[39m[33m,[39m error)[33m;[39m
     [90m    |[39m               [31m[1m^[22m[39m
     [90m 70 |[39m       [36mthrow[39m error[33m;[39m
     [90m 71 |[39m     }
     [90m 72 |[39m   }[0m

      at UserService.getUserById (src/services/userService.js:69:15)
      at UserController.getUserById (src/controllers/userController.js:151:20)

  console.error
    Error obteniendo usuario: Error: Usuario no encontrado
        at UserService.getUserById (D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\services\userService.js:64:15)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at UserController.getUserById (D:\DEX\Yross\U\asignat\Informatica\25-2\Ing_software_2\Proyecto\gestion-proyectos-backend\src\controllers\userController.js:151:20)

    [0m [90m 164 |[39m
     [90m 165 |[39m     } [36mcatch[39m (error) {
    [31m[1m>[22m[39m[90m 166 |[39m       console[33m.[39merror([32m'Error obteniendo usuario:'[39m[33m,[39m error)[33m;[39m
     [90m     |[39m               [31m[1m^[22m[39m
     [90m 167 |[39m       res[33m.[39mstatus([35m500[39m)[33m.[39mjson({
     [90m 168 |[39m         success[33m:[39m [36mfalse[39m[33m,[39m
     [90m 169 |[39m         message[33m:[39m [32m'Error interno del servidor'[39m[0m

      at UserController.getUserById (src/controllers/userController.js:166:15)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:44 +0000] "GET /api/users/99999 HTTP/1.1" 500 56 "-" "-" {"timestamp":"2025-09-19T17:29:44.069Z"}
  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Actualizar usuario como admin

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4295,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4295, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4295,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4296,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: PUT /4296

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60275",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5NSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4NCwiZXhwIjoxNzU4MzA2NTg0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.b_uMSiQjGKVfJMMUOmg7A_W60uW47fpm-Dm3Bia1l3A",
      "content-type": "application/json",
      "content-length": "65",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5NSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4NCwiZXhwIjoxNzU4MzA2NTg0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.b_uMSiQjGKVfJMMUOmg7A_W60uW47fpm-Dm3Bia1l3A

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4295, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4295

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: {
      id: 4295,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: {
      id: 4295,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4295, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4295,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contraseña': '$2b$10$E1vw6TwoDulngcYQ/Ut8y.kc/88x7t3N2InUf.GFG.Ls33EHlzeem',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:29:44.000Z,
      updated_at: 2025-09-19T17:29:44.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4295

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4296

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4296, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4296

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4296, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:44 +0000] "PUT /api/users/4296 HTTP/1.1" 200 322 "-" "-" {"timestamp":"2025-09-19T17:29:44.262Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Usuario actualizado por admin correctamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Usuario regular no puede actualizar otros

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4297,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4297, email: 'test@example.com', es_administrador: false }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5N...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4297,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "otro@test.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4298,
      "email": "otro@test.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: PUT /4298

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60277",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5NywiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4NCwiZXhwIjoxNzU4MzA2NTg0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.z7SFjwW8BL2oNCP5nSZ7C3uJ8Du79g2-4mpCOxJW_ds",
      "content-type": "application/json",
      "content-length": "38",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5NywiZW1haWwiOiJ0ZXN0QGV4YW1wbGUuY29tIiwiZXNfYWRtaW5pc3RyYWRvciI6ZmFsc2UsImlhdCI6MTc1ODMwMjk4NCwiZXhwIjoxNzU4MzA2NTg0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.z7SFjwW8BL2oNCP5nSZ7C3uJ8Du79g2-4mpCOxJW_ds

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4297, email: 'test@example.com', es_administrador: false }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4297

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: { id: 4297, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: { id: 4297, email: 'test@example.com', es_administrador: 0, estado: 1 }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4297, email: 'test@example.com', es_administrador: 0 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4297,
      nombre: 'Usuario Test',
      email: 'test@example.com',
      'contraseña': '$2b$10$rwZ47iwHIiI3J57vFMT2d.JodulQHdg/maCBTbUlF6jFOTn.IiRZy',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 0,
      configuraciones: null,
      created_at: 2025-09-19T17:29:44.000Z,
      updated_at: 2025-09-19T17:29:44.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4297

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario no es admin, obteniendo roles...

      at src/middleware/permissionMiddleware.js:328:17

  console.log
    getUserRolesStatic - Iniciando para userId: 4297

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias únicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Roles obtenidos: []

      at src/middleware/permissionMiddleware.js:333:19

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Permisos finales: []

      at src/middleware/permissionMiddleware.js:350:19

  console.log
    getUserRolesStatic - Iniciando para userId: 4297

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:70:15)

  console.log
    getUserRolesStatic - Ejecutando query SQL directa con alias únicos

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:95:15)

  console.log
    getUserRolesStatic - Resultado obtenido: 0 roles

      at Function.getUserRolesStatic (src/repositories/UserRoleRepository.js:101:15)

[32minfo[39m: ::ffff:127.0.0.1 - - [19/Sep/2025:17:29:44 +0000] "PUT /api/users/4298 HTTP/1.1" 403 135 "-" "-" {"timestamp":"2025-09-19T17:29:44.465Z"}
  console.log
    
    ✅ [USERS-TESTS] [SUCCESS] Protección de actualización funcionando

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Limpiando datos de prueba de autenticación

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Datos de prueba de autenticación limpiados

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🗄️  [DB-HELPER] [DB] Limpiando datos de prueba

      at TestLogger.database (tests/utils/TestLogger.js:147:13)

  console.log
    
    ✅ [DB-HELPER] [SUCCESS] Datos de prueba limpiados exitosamente

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
    
    🔵 [USERS-TESTS] [INFO] Test: Eliminar usuario como admin

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "admin@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4299,
      "email": "admin@example.com",
      "es_administrador": true
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-HELPER] Generando token para usuario: { id: 4299, email: 'admin@example.com', es_administrador: true }

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:101:15)

  console.log
    🔐 [AUTH-HELPER] JWT_SECRET usado: dev_secret_key

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:106:15)

  console.log
    🔐 [AUTH-HELPER] Token generado exitosamente: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5O...

      at AuthHelper.generateToken (tests/utils/AuthHelper.js:113:15)

  console.log
    
    🔍 [AUTH-HELPER] [DEBUG] Token generado

      at TestLogger.debug (tests/utils/TestLogger.js:68:13)

  console.log
       🔧 Debug: {
      "userId": 4299,
      "expiresIn": "1h"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    🔵 [AUTH-HELPER] [INFO] Creando usuario de prueba

      at TestLogger.info (tests/utils/TestLogger.js:22:13)

  console.log
       📋 Datos: {
      "email": "test@example.com"
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    
    ✅ [AUTH-HELPER] [SUCCESS] Usuario de prueba creado

      at TestLogger.success (tests/utils/TestLogger.js:34:13)

  console.log
       📋 Respuesta: {
      "id": 4300,
      "email": "test@example.com",
      "es_administrador": false
    }

      at TestLogger._logData (tests/utils/TestLogger.js:161:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Iniciando autenticación para: DELETE /4300

      at src/middleware/authMiddleware.js:27:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Headers: {
      "host": "127.0.0.1:60281",
      "accept-encoding": "gzip, deflate",
      "authorization": "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5OSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4NCwiZXhwIjoxNzU4MzA2NTg0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.QOS6g4k5WZGZCpMRnbKvntEFTeJEE4SLv8XbPJFomMw",
      "content-type": "application/json",
      "connection": "close"
    }

      at src/middleware/authMiddleware.js:28:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token extraído: Presente

      at src/middleware/authMiddleware.js:32:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token completo: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDI5OSwiZW1haWwiOiJhZG1pbkBleGFtcGxlLmNvbSIsImVzX2FkbWluaXN0cmFkb3IiOnRydWUsImlhdCI6MTc1ODMwMjk4NCwiZXhwIjoxNzU4MzA2NTg0LCJpc3MiOiJnZXN0aW9uLXByb3llY3Rvcy10ZXN0In0.QOS6g4k5WZGZCpMRnbKvntEFTeJEE4SLv8XbPJFomMw

      at src/middleware/authMiddleware.js:33:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando blacklist...

      at src/middleware/authMiddleware.js:44:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Token en blacklist: false

      at src/middleware/authMiddleware.js:46:17

  console.log
    🔐 [AUTH-MIDDLEWARE] Verificando token...

      at src/middleware/authMiddleware.js:57:17

  console.log
    🔐 [AUTH-SERVICE] Verificando token...

      at AuthService.verifyToken (src/services/authService.js:130:15)

  console.log
    🔐 [AUTH-SERVICE] JWT_SECRET: Presente

      at AuthService.verifyToken (src/services/authService.js:131:15)

  console.log
    🔐 [AUTH-SERVICE] Token decodificado: { id: 4299, email: 'admin@example.com', es_administrador: true }

      at AuthService.verifyToken (src/services/authService.js:135:15)

  console.log
    🔍 [USER-REPO] Buscando usuario por ID: 4299

      at UserRepository.findById (src/repositories/UserRepository.js:23:15)

  console.log
    🔍 [USER-REPO] Usuarios encontrados: 1

      at UserRepository.findById (src/repositories/UserRepository.js:30:15)

  console.log
    🔍 [USER-REPO] Usuario encontrado: {
      id: 4299,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at UserRepository.findById (src/repositories/UserRepository.js:32:17)

  console.log
    🔐 [AUTH-SERVICE] Usuario encontrado: {
      id: 4299,
      email: 'admin@example.com',
      es_administrador: 1,
      estado: 1
    }

      at AuthService.verifyToken (src/services/authService.js:139:15)

  console.log
    🔐 [AUTH-SERVICE] Usuario verificado exitosamente

      at AuthService.verifyToken (src/services/authService.js:151:15)

  console.log
    🔐 [AUTH-MIDDLEWARE] Usuario verificado: { id: 4299, email: 'admin@example.com', es_administrador: 1 }

      at src/middleware/authMiddleware.js:59:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Iniciando

      at src/middleware/permissionMiddleware.js:306:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - req.user: {
      id: 4299,
      nombre: 'Admin Test',
      email: 'admin@example.com',
      'contraseña': '$2b$10$eeecREwnVqX7OAHbJaZ0BOBuDuo9k.TRtnVVmWzxzjmcLfu9.2VJ2',
      telefono: '1234567890',
      estado: 1,
      es_administrador: 1,
      configuraciones: null,
      created_at: 2025-09-19T17:29:44.000Z,
      updated_at: 2025-09-19T17:29:44.000Z
    }

      at src/middleware/permissionMiddleware.js:307:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario autenticado, ID: 4299

      at src/middleware/permissionMiddleware.js:318:17

  console.log
    🔑 [PERMISSION-MIDDLEWARE] attachPermissions - Usuario es administrador

      at src/middleware/permissionMiddleware.js:322:19



STDERR:
No stderr

MESSAGE:
spawnSync C:\WINDOWS\system32\cmd.exe ETIMEDOUT
